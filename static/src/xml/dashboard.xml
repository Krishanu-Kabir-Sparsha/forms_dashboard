<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="forms_dashboard.MainDashboard">
        <div class="forms_dashboard_main">
            <!-- Filters Section -->
            <div class="forms_dashboard_filters">
                <div class="forms_dashboard_filter_group">
                    <label for="dateRange" class="me-2">Date Range:</label>
                    <select class="form-select" id="dateRange" t-on-change="onDateRangeChange">
                        <option value="7">Last 7 Days</option>
                        <option value="30">Last 30 Days</option>
                        <option value="90">Last 90 Days</option>
                        <option value="all">All Time</option>
                        <option value="custom">Custom Date Range</option>
                    </select>
                </div>
                
                <!-- Custom Date Range Picker -->
                <t t-if="state.showCustomDate">
                    <div class="forms_dashboard_custom_date_group">
                        <label for="dateFrom" class="me-2">From:</label>
                        <input type="date" 
                               id="dateFrom" 
                               class="form-control form-control-sm" 
                               t-att-value="state.customDateFrom"
                               t-on-change="(ev) => { state.customDateFrom = ev.target.value; onCustomDateChange(); }"/>
                        <label for="dateTo" class="mx-2">To:</label>
                        <input type="date" 
                               id="dateTo" 
                               class="form-control form-control-sm" 
                               t-att-value="state.customDateTo"
                               t-on-change="(ev) => { state.customDateTo = ev.target.value; onCustomDateChange(); }"/>
                    </div>
                </t>
                
                <div class="forms_dashboard_filter_group">
                    <label for="statusFilter" class="me-2">Status:</label>
                    <select class="form-select" id="statusFilter" t-on-change="onStatusChange">
                        <option value="all">All Status</option>
                        <option value="new">New</option>
                        <option value="in_progress">In Progress</option>
                        <option value="qualified">Qualified</option>
                        <option value="done">Done</option>
                        <option value="cancelled">Cancelled</option>
                        <option value="declined">Declined</option>
                        <option value="converted">Converted</option>
                        <option value="committed">Committed</option>
                        <option value="received">Received</option>
                        <option value="approved">Approved</option>
                        <option value="active">Active</option>
                    </select>
                </div>
                <button class="btn btn-secondary" t-on-click="exportData">
                    <i class="fa fa-download me-2"/>Export
                </button>
                <div t-if="state.loading" class="loading-spinner"/>
                <div class="ms-auto text-muted">
                    <small>Last updated: <t t-esc="state.lastUpdate"/></small>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="forms_dashboard_charts mb-4">
                <div class="forms_dashboard_chart_card">
                    <div class="forms_dashboard_chart_header">
                        <div class="forms_dashboard_chart_title">Inquiry Trends</div>
                        <select class="form-select form-select-sm" style="width: auto;" t-on-change="onTrendPeriodChange">
                            <option value="daily" t-att-selected="state.trendPeriod === 'daily' ? 'selected' : undefined">Daily</option>
                            <option value="weekly" t-att-selected="state.trendPeriod === 'weekly' ? 'selected' : undefined">Weekly</option>
                            <option value="monthly" t-att-selected="state.trendPeriod === 'monthly' ? 'selected' : undefined">Monthly</option>
                        </select>
                    </div>
                    <div class="forms_dashboard_chart_container">
                        <canvas t-ref="trendChart"></canvas>
                    </div>
                </div>
                
                <div class="forms_dashboard_chart_card">
                    <div class="forms_dashboard_chart_header">
                        <div class="forms_dashboard_chart_title">Status Distribution</div>
                    </div>
                    <div class="forms_dashboard_chart_container">
                        <canvas t-ref="statusChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="forms_dashboard_stats">
                <div class="forms_dashboard_stat_card" t-on-click="openPartnerships">
                    <div class="forms_dashboard_stat_icon">
                        <i class="fa fa-handshake-o"/>
                    </div>
                    <div class="forms_dashboard_stat_number">
                        <t t-esc="state.partnerships"/>
                    </div>
                    <div class="forms_dashboard_stat_label">Partnerships</div>
                    <div t-if="state.partnerships_new" class="mt-2">
                        <span class="badge badge-new">
                            <t t-esc="state.partnerships_new"/> New
                        </span>
                    </div>
                </div>

                <div class="forms_dashboard_stat_card" t-on-click="openDonations">
                    <div class="forms_dashboard_stat_icon">
                        <i class="fa fa-gift"/>
                    </div>
                    <div class="forms_dashboard_stat_number">
                        <t t-esc="state.donations"/>
                    </div>
                    <div class="forms_dashboard_stat_label">Donations</div>
                    <div t-if="state.donations_new" class="mt-2">
                        <span class="badge badge-new">
                            <t t-esc="state.donations_new"/> New
                        </span>
                    </div>
                </div>

                <div class="forms_dashboard_stat_card" t-on-click="openCollaborations">
                    <div class="forms_dashboard_stat_icon">
                        <i class="fa fa-users"/>
                    </div>
                    <div class="forms_dashboard_stat_number">
                        <t t-esc="state.collaborations"/>
                    </div>
                    <div class="forms_dashboard_stat_label">Collaborations</div>
                    <div t-if="state.collaborations_new" class="mt-2">
                        <span class="badge badge-new">
                            <t t-esc="state.collaborations_new"/> New
                        </span>
                    </div>
                </div>
            </div>

            <!-- Recent Activity Section -->
            <div class="forms_dashboard_recent">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3 class="mb-0">Recent Activity</h3>
                    <small class="text-muted">Click on any row to view details</small>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover forms_dashboard_activity_table">
                        <thead>
                            <tr>
                                <th>Reference</th>
                                <th>Type</th>
                                <th>Status</th>
                                <th>Submission Date</th>
                                <th class="text-center" style="width: 50px;">
                                    <i class="fa fa-external-link" title="View"/>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="state.recentActivity" t-as="activity" t-key="activity.id">
                                <tr class="forms_dashboard_clickable_row" 
                                    t-on-click="openInquiryRecord.bind(this, activity)"
                                    t-att-data-record-id="activity.recordId"
                                    t-att-data-model="activity.model">
                                    <td>
                                        <span class="fw-bold text-primary"><t t-esc="activity.name"/></span>
                                    </td>
                                    <td>
                                        <span class="badge badge-light text-dark">
                                            <t t-esc="activity.type"/>
                                        </span>
                                    </td>
                                    <td>
                                        <span t-attf-class="badge badge-#{activity.state}">
                                            <t t-esc="activity.state.replace('_', ' ').charAt(0).toUpperCase() + activity.state.replace('_', ' ').slice(1)"/>
                                        </span>
                                    </td>
                                    <td><t t-esc="activity.date"/></td>
                                    <td class="text-center">
                                        <i class="fa fa-arrow-right text-primary"/>
                                    </td>
                                </tr>
                            </t>
                            <tr t-if="!state.recentActivity || state.recentActivity.length === 0">
                                <td colspan="5" class="text-center text-muted py-3">
                                    No activities found
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Floating Refresh Button -->
            <button class="forms_dashboard_refresh" t-on-click="refresh" title="Refresh Dashboard">
                <i class="fa fa-refresh"/>
            </button>
        </div>
    </t>
</templates>